package me.ionar.salhack.module.exploit;

import me.ionar.salhack.events.network.EventNetworkPacketEvent;
import me.ionar.salhack.events.player.EventPlayerUpdate;
import me.ionar.salhack.module.Module;
import me.zero.alpine.fork.listener.EventHandler;
import me.zero.alpine.fork.listener.Listener;

import net.minecraft.network.play.client.CPacketPlayer;

//Thanks to Wolfram at https://www.wolframclient.net/ for this Module.
public class GhostModule extends Module {

    public GhostModule()
    {
        super("Ghost", new String[]
                { "Ghost" }, "Stay alive after dying.", "NONE", 0xDB6824, ModuleType.EXPLOIT);
    }

    boolean bypassdeath;

    @EventHandler
    private Listener<EventPlayerUpdate> onTick = new Listener<>(p_Event -> {
       if (mc.world == null || !isEnabled()) {
           return;
       }

       if (mc.player.getHealth() == 0.0f) {
           mc.player.setHealth(20.0f);
           mc.player.isDead = false;
           this.bypassdeath = true;
           this.mc.displayGuiScreen(null);
           mc.player.setPositionAndUpdate(mc.player.posX, mc.player.posY, mc.player.posZ);
       }
    });

    @EventHandler
    private Listener<EventNetworkPacketEvent> netWorkManagerListener = new Listener<>(p_Event -> {
        if (bypassdeath && p_Event.getPacket() instanceof CPacketPlayer) {
            p_Event.cancel();
        }
    });

    @Override
    public void onDisable() {
        if (mc.player != null) {
            mc.player.respawnPlayer();
        }
        this.bypassdeath = false;
    }

}
